<ion-header>
  <ion-toolbar>
    <ion-title>privilege-select</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="hasLoaded && data$ | async as data">
    <ion-grid margin-top>
      <ion-row align-items-center>
        <ion-col>

        </ion-col>
        <ion-col col-auto>
          <span class="privilege-point center bold"><img width="18" height="18" class="qr"
              src="assets/imgs/privilege-point.png" />&nbsp;{{ data.memberPoint | number:'1.0' }}</span>
        </ion-col>
        <ion-col text-right>
          <img *ngIf="false" width="18" height="18" class="qr" src="assets/imgs/privilege-info.png" />
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- <ion-searchbar mode="ios" (ionInput)="onSearch($event)"></ion-searchbar> -->

    <ion-list *ngIf="data.privilege?.length == 0" no-lines>
      <ion-item margin-top text-center>
        ไม่มีรายการ
      </ion-item>
    </ion-list>

    <ion-list *ngIf="data.privilege?.length != 0" no-lines no-lines>
      <!-- TODO : Replace variable -->
      <ion-card margin-top *ngFor="let item of data.privileges" (click)="visitEndpoint(item)">
        <ion-grid padding-left padding-right>
          <ion-row align-items-center>
            <ion-col col-auto>
              <h2>
                <b>{{ item.privilege.name }}</b>
              </h2>
            </ion-col>
            <ion-col text-right *ngIf="item.promotion">
              <ion-icon class="text-yellow bold" name="ios-flash"></ion-icon>
              <span class="text-red">
                {{ DisplayExpireDateTime(item.promotion) }}
              </span>
            </ion-col>
          </ion-row>
          <ion-row>
            <div class="eslip">
              <img *ngIf="!item.privilege.rewardBannerUrl" width="100%" class="eslip-banner"
                src="https://png.pngtree.com/thumb_back/fw800/background/20190222/ourmid/pngtree-orange-and-yellow-gradient-banner-background-imagegradientbackground-image-image_49980.jpg" />
              <img *ngIf="item.privilege.rewardBannerUrl && (!item.promotion || !item.promotion.promotionBanner)"
                width="100%" class="eslip-banner" [src]="item.privilege.rewardBannerUrl" />
              <img *ngIf="item.promotion && item.promotion.promotionBanner" width="100%" class="eslip-banner"
                [src]="item.promotion.promotionBanner" />
            </div>
          </ion-row>
          <ion-row align-items-center>
            <ion-col col-auto>
              <img width="18" height="18" class="qr" src="assets/imgs/privilege-point.png" />
            </ion-col>
            <ion-col col-auto>
              <h3><span
                  [ngClass]="{'text-red line-through': item.promotion}">{{ item.privilege.point | number:'1.0' }}</span>
                <span *ngIf="item.promotion">{{ item.promotion.promotionPoint | number:'1.0' }}</span>
                <span>(จำนวนที่เหลือ {{ item.remainAmount }})</span>
              </h3>
            </ion-col>
            <ion-col text-right
              *ngIf="(item.promotion && data.memberPoint >= item.promotion.promotionPoint && item.remainAmount > 0) || (!item.promotion && data.memberPoint >= item.privilege.point && item.remainAmount > 0)">
              <span class="text-blue">
                <ion-icon name="ios-checkmark-circle"></ion-icon> แลกได้แล้ว
              </span>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card>
    </ion-list>

  </ng-container>

  <ng-container *ngIf="!hasLoaded">

    <ion-grid margin-top>
      <ion-row align-items-center>
        <ion-col>

        </ion-col>
        <ion-col col-auto>
          <span class="privilege-point center bold"><img width="18" height="18" class="qr"
              src="assets/imgs/privilege-point.png" />&nbsp; - </span>
        </ion-col>
        <ion-col text-right>
          <img *ngIf="false" width="18" height="18" class="qr" src="assets/imgs/privilege-info.png" />
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- <ion-searchbar mode="ios" (ionInput)="onSearch($event)"></ion-searchbar> -->

    <ion-list no-lines>
      <ion-item margin-top text-center>
        กำลังโหลดข้อมูล กรุณารอสักครู่...
      </ion-item>
    </ion-list>

    <ion-list *ngIf="true" no-lines no-lines>

    </ion-list>

  </ng-container>
</ion-content>
