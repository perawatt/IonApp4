<ion-header>
  <ion-toolbar>
    <ion-title>{{ title }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content mode="ios">
  <ng-container *ngIf="data$ | async as data">
      <ion-list lines="none" *ngIf="hasLoaded">
        <ion-item color="tertiary" class="ion-margin-bottom">
          <ion-avatar class="avatar-small" slot="start">
              <!-- TODO: Add default logo -->
            <img [src]="data.shippingMethod?.logo" />
          </ion-avatar>
          <ion-label><b>{{data.shippingMethod?.name}}</b></ion-label>
        </ion-item>

        <ion-card color="tertiary">
          <ion-card-content class="ion-no-padding">
            <div class="ion-text-center ion-padding-top">
              <ion-avatar slot="start" class="avatar-large center">
                <img [src]="data.bizAccount?.logoUrl">
              </ion-avatar>
              <ion-label class="ion-text-center">
                <b>{{data.bizAccount?.name}}</b>
              </ion-label>
            </div>

            <ion-item class="ion-no-padding" color="tertiary" lines="full">
                <ion-grid class="ion-padding">
                  <ion-row>
                    <ion-col class="ion-no-padding">
                      <ion-label>รายละเอียดการจ่ายเงิน</ion-label>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col class="ion-no-padding">
                      <ion-label>
                        <h2>รวมค่าสินค้า</h2>
                      </ion-label>
                    </ion-col>
                    <ion-col class="ion-no-padding ion-text-right">฿{{data.totalBeforeDiscount[0].amountUnit}}
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col class="ion-no-padding">
                      <ion-label>
                        <h2>ค่าจัดส่ง</h2>
                      </ion-label>
                    </ion-col>
                    <ion-col class="ion-no-padding ion-text-right">฿{{data.shippingMethod.shippingFees.amountUnit}}
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col class="ion-no-padding">
                      <ion-label>
                        <h2>ส่วนลด</h2>
                      </ion-label>
                    </ion-col>
                    <ion-col class="ion-no-padding ion-text-right">฿{{data.discount[0].amountUnit}}
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col class="ion-no-padding">
                      <ion-label>
                        <h2>ราคารวมทั้งหมด</h2>
                      </ion-label>
                    </ion-col>
                    <ion-col class="ion-no-padding ion-text-right">
                      <ion-text color="danger"><b>฿{{data.totalToPay[0].amountUnit}}</b>
                      </ion-text>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-item>

            <ion-item color="tertiary" class="ion-no-padding">
              <ion-label class="ion-padding-start">
                <h2>
                  ใส่คูปองหรือแต้ม
                </h2>
              </ion-label>
              <ion-fab horizontal="end">
                <ion-fab-button class="fab-small" size="small" color="danger">
                  <ion-icon color="light" name="add"></ion-icon>
                </ion-fab-button>
                <ion-fab-list side="start">
                  <ion-fab-button class="fab-small">
                    <ion-icon name="point"></ion-icon>
                  </ion-fab-button>
                  <ion-fab-button class="fab-small">
                    <ion-icon name="coupon"></ion-icon>
                  </ion-fab-button>
                </ion-fab-list>
              </ion-fab>
            </ion-item>
          </ion-card-content>
        </ion-card>
        <!-- <ion-item color="tertiary">
        <ion-label> Coupon Name </ion-label>
      </ion-item>
      <ion-item class="couponImage" color="tertiary">
        <img src="assets/imgs/Coupontest.png" class="ion-margin-bottom">
        <ion-note color="danger" slot="end">ลบ</ion-note>
      </ion-item> -->
      </ion-list>
      <ion-list class="ion-margin-top" lines="full">
        <ion-item class="ion-no-padding" color="tertiary" lines="none">
          <ion-label class="ion-padding-start">รายการที่สั่ง ({{data.products?.length}} ชิ้น)</ion-label>
        </ion-item>

        <ion-item *ngFor="let product of data.products" color="tertiary" class="ion-no-padding">
          <ion-grid class="ion-no-padding">
            <ion-row class=" ion-padding-start ion-padding-vertical">
              <ion-col>
                <ion-row>
                  <ion-col class="ion-no-padding">
                    <ion-label>
                      <h2>X {{product.quantity}} {{product.name}}</h2>
                    </ion-label>
                  </ion-col>
                  <ion-col class="ion-no-padding ion-text-end" size="4">
                     <ion-label>
                        <h2>
                          <ion-text [color]="product.promotionPrice?.amountUnit? 'danger' : 'dark'"
                            [ngClass]="{'line-through': product.promotionPrice?.amountUnit}">
                            ฿{{ product.unitPrice?.amountUnit | number:'1.0' }}</ion-text>
                          <ion-text *ngIf="product.promotionPrice"> ฿{{product.promotionPrice?.amountUnit | number:'1.0' }}
                          </ion-text>
                        </h2>
                      </ion-label>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col class="ion-no-padding">
                    <ion-label>
                      <ion-text color="danger">
                        <!-- TODO: Text wrap  -->
                        <h3><span *ngFor="let option of product.options; let i = index"><span *ngIf="i > 0">, </span>{{option.name}}</span></h3>
                      </ion-text>
                    </ion-label>
                  </ion-col>
                </ion-row>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>

      </ion-list>
      <!-- <ion-button id="app-form-submit" color="danger" class="ion-no-margin" expand="full" type="submit">จ่ายเงิน
      </ion-button> -->
  </ng-container>

  <ng-container *ngIf="!hasLoaded">
    <ion-item lines="none">
      <ion-avatar slot="start">
        <ion-skeleton-text animated></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <ion-skeleton-text animated></ion-skeleton-text>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
      </ion-label>
    </ion-item>
    <ion-card color="light" class="ion-text-center">
      <ion-card-content>
        <ion-skeleton-text class="center circle ion-margin-bottom" animated style="width:100px; height:100px">
        </ion-skeleton-text>
      </ion-card-content>
    </ion-card>  
    <ion-item lines="none">
      <ion-label>
        <ion-skeleton-text animated></ion-skeleton-text>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
      </ion-label>
    </ion-item>
    <ion-item lines="none">
      <ion-avatar slot="start">
        <ion-skeleton-text animated></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <ion-skeleton-text animated></ion-skeleton-text>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
      </ion-label>
    </ion-item>
    <ion-item lines="none">
      <ion-avatar slot="start">
        <ion-skeleton-text animated></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <ion-skeleton-text animated></ion-skeleton-text>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
      </ion-label>
    </ion-item>
    <ion-item lines="none">
      <ion-avatar slot="start">
        <ion-skeleton-text animated></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <ion-skeleton-text animated></ion-skeleton-text>
        <h3>
          <ion-skeleton-text animated></ion-skeleton-text>
        </h3>
      </ion-label>
    </ion-item>
  </ng-container>
</ion-content>